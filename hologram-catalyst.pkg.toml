[package]
name        = "hologram-catalyst"
version     = "1.1.5"
description = "hologram: Catalyst driver"

requires = [
    "holo>=0.10",
    "hologram-catalyst-repo",
    "catalyst-hook",
    "catalyst-libgl",
    "catalyst-utils",
    "opencl-catalyst",
    "lib32-catalyst-libgl",
    "lib32-catalyst-utils",
    "lib32-opencl-catalyst",
]

[[symlink]]
path   = "/etc/systemd/system/multi-user.target.wants/catalyst-hook.service"
target = "/usr/lib/systemd/system/catalyst-hook.service"

# don't enable amdgpu until Catalyst is ready for it
[[file]]
path    = "/etc/modprobe.d/catalyst.conf"
content = """
    blacklist radeon
    blacklist amdgpu
"""

# add "nomodeset" to kernel command line
[[file]]
path    = "/usr/share/holo/files/20-catalyst/boot/loader/entries/arch.conf.holoscript"
mode    = "0755"
content = """
    #!/bin/sh
    sed '/^options/s/$/ nomodeset/'
"""

# configure Xorg (generated by `aticonfig --initial`)
[[file]]
path    = "/etc/X11/xorg.conf.d/20-radeon.conf"
content = """
    Section "ServerLayout"
        Identifier     "aticonfig Layout"
        Screen      0  "aticonfig-Screen[0]-0" 0 0
    EndSection

    Section "Module"
    EndSection

    Section "Monitor"
        Identifier   "aticonfig-Monitor[0]-0"
        Option	    "VendorName" "ATI Proprietary Driver"
        Option	    "ModelName" "Generic Autodetecting Monitor"
        Option	    "DPMS" "true"
    EndSection

    Section "Device"
        Identifier  "aticonfig-Device[0]-0"
        Driver      "fglrx"
        BusID       "PCI:1:0:0"
    EndSection

    Section "Screen"
        Identifier "aticonfig-Screen[0]-0"
        Device     "aticonfig-Device[0]-0"
        Monitor    "aticonfig-Monitor[0]-0"
        DefaultDepth     24
        SubSection "Display"
            Viewport   0 0
            Depth     24
        EndSubSection
    EndSection
"""
