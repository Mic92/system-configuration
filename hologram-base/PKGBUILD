pkgname='hologram-base'
pkgver=20150804
pkgrel=1
pkgdesc='hologram: base installation'
arch=('any')
url=''
license=('BSD')
depends=() # runtime dependencies are listed below
replaces=('holodeck-base') # this used to be called "holodeck" incorrectly
source=(
    'journald.conf'
    'locale.conf'
    'locale.gen'
    'mirrorlist.holoscript'
    'pacman.conf.holoscript'
    'sudoers'
    'timesyncd.conf'
    'vconsole.conf'
)
install='hologram-base.install'

package() {
    depends=(
        'holo-tools' # obviously :)
        # base system
        $(pacman -Sqg base | grep -v netctl)
        $(pacman -Sqg base-devel)
        # system components
        'haveged'
        'hologram-openssh'
        # assorted CLI tools
        'ack'
        'acpi'
        'atop'
        'dnsutils'
        'dosfstools'     # mkfs.vfat
        'git'
        'gptfdisk'
        'htop'
        'inotify-tools'
        'lsof'
        'net-tools'      # netstat
        'nmap'           # ncat
        'pwgen'
        'smartmontools'
        'rsync'
        'screen'
        'strace'
        'sudo'
        'tcpdump'
        'traceroute'
        'tree'
        'units'
        'unrar'
        'unzip'
        'vim'
        'wget'
        'whois'
        'zip'
        'zsh'
    )

    mkdir -p "${pkgdir}/etc/systemd/system/multi-user.target.wants/"
    ln -sf /usr/lib/systemd/system/systemd-networkd.service  "${pkgdir}/etc/systemd/system/multi-user.target.wants/systemd-networkd.service"
    ln -sf /usr/lib/systemd/system/haveged.service           "${pkgdir}/etc/systemd/system/multi-user.target.wants/haveged.service"
    mkdir -p "${pkgdir}/etc/systemd/system/sysinit.target.wants/"
    ln -sf /usr/lib/systemd/system/systemd-timesyncd.service "${pkgdir}/etc/systemd/system/sysinit.target.wants/systemd-timesyncd.service"
    ln -sf /usr/share/zoneinfo/Europe/Berlin                 "${pkgdir}/etc/localtime"

    install -D -m 0644 journald.conf          "${pkgdir}/etc/systemd/journald.conf.d/hologram-base.conf"
    install -D -m 0644 timesyncd.conf         "${pkgdir}/etc/systemd/timesyncd.conf.d/hologram-base.conf"
    install -D -m 0644 locale.conf            "${pkgdir}/etc/locale.conf"
    install -D -m 0644 locale.gen             "${pkgdir}/holo/repo/etc/locale.gen"
    install -D -m 0755 mirrorlist.holoscript  "${pkgdir}/holo/repo/etc/pacman.d/mirrorlist.holoscript"
    install -D -m 0755 pacman.conf.holoscript "${pkgdir}/holo/repo/etc/pacman.conf.holoscript"
    install -D -m 0440 sudoers                "${pkgdir}/holo/repo/etc/sudoers"
    install -D -m 0644 vconsole.conf          "${pkgdir}/etc/vconsole.conf"
}
